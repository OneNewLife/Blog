<!DOCTYPE html> <html lang="pt-br"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> 稀疏数组与数组空位 &bull; Mars Blog </title> <meta name="description" content="平安夜逛社区的时候，有一位同学就犀牛书上对稀疏数组的解读提出了质疑，这里贴上犀牛书 147 页的截图："> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://mars.js.org/sparse-array/"> <link rel="alternate" type="application/rss+xml" title="Mars Blog" href="https://mars.js.org/feed.xml" /> </head> <body class="single"> <main class="main"> <header class="header"> <div class="overlay"> <div style="padding: 0 1em;"> <h1 class="title"> <a href="/">Mars Blog</a> </h1> <nav class="navbar"> <a href="#" class="menu-icon"> <span></span> <span></span> <span></span> </a> <ul class="nav"> <li><a href="/">Home</a></li> <li><a href="/archive.html">Archive</a></li> </ul> </nav> </div> </div> </header> <article class="post container card"> <header class="post-header"> <h1 class="post-title">稀疏数组与数组空位</h1> <span class="post-meta"> <time class="post-date" datetime="2015-12-26">Dec 26, 2015</time> <span class="post-author">by Mars Wong</span> </span> </header> <div class="post-content"> <p>平安夜逛社区的时候，有一位同学就犀牛书上对稀疏数组的解读提出了质疑，这里贴上犀牛书 147 页的截图：</p> <p><img src="../images/2015.12.26/book.jpg" alt="犀牛书 P147" /></p> <p>上面应该能很清楚看到一个红圈圈着的 true，犀牛书认为稀疏数组 a1 在索引 0 处有一个元素，而事实是在最新的浏览器下，<code class="highlighter-rouge">0 in a1</code> 的返回值都是 false 了。这个问题顺带把数组空位给扯出来了，我和王同学在一番引诱下对其展开了研究。</p> <p>首先要知道犀牛书遵从的是 es5 标准，而现在主流浏览器都开始遵从 es6 标准了。那么 es6 对数组空位作了哪些改动呢？</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">a1</span> <span class="o">=</span> <span class="p">[,,,];</span>
<span class="mi">0</span> <span class="k">in</span> <span class="nx">a1</span><span class="p">;</span> <span class="c1">// false</span>
<span class="nx">a1</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// 3</span>
</code></pre></div></div> <p>可以看到 <code class="highlighter-rouge">0 in a1</code> 返回 false 了，这是因为 es6 不再将空位当成 undefined 了，同时 <code class="highlighter-rouge">a1.length</code> 的值是 3 而不是 4 了，在 es5 中稀疏数组的 length 属性值大于元素的个数，es6 则变得更容易理解：length = 索引数 = 空位数</p> <p>再来看看 <code class="highlighter-rouge">for...of</code> 循环:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[,,,];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'yes'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// yes</span>
<span class="c1">// yes</span>
<span class="c1">// yes</span>
</code></pre></div></div> <p>可以看到 <code class="highlighter-rouge">for...of</code> 并没有跳过空位,而 es5 则会跳过空位。同时在使用 <code class="highlighter-rouge">forEach()</code>、<code class="highlighter-rouge">filter()</code>、<code class="highlighter-rouge">some()</code> 方法的时候 es5 会跳过空位，而 es6 则会明确地将空位转为 undefined。</p> <h3 id="reference">Reference</h3> <ul> <li><a href="http://es6.ruanyifeng.com/#docs/array#数组的空位">《ECMAScript6 入门》</a></li> </ul> <aside class="share"> <span>Share this: </span> <a href="http://twitter.com/share?text=稀疏数组与数组空位&amp;url=https://mars.js.org/sparse-array/&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fa fa-twitter-square"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://mars.js.org/sparse-array/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"> <i class="fa fa-facebook-square"></i> </a> </aside> </div> </article> <footer class="footer t-center"> <div class="container"> <div class="social-icons"> <ul class="text-left"> <li><a href="https://www.facebook.com/maaarswong" target="_blank"><i class="fa fa-facebook"></i></a></li> <li><a href="https://twitter.com/maaarswong" target="_blank"><i class="fa fa-twitter"></i></a></li> </ul> </div> <small> <a href=https://github.com/marswong target="_blank">Mars Wong</a> &copy; 2015 - 2020 All rights reserved. </small> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"> <img alt="Creative Commons License" style="border-width: 0;margin: .5em auto;" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /> </a> </div> </footer> </main> <script src="/js/typed.min.js"></script> <script> window.onload = function () { new Typed('#motto', { strings: ['起风了，唯有努力生存'], contentType: 'html', typeSpeed: 100, showCursor: false }); } </script> </body> </html></body></html>
